version: 2

models:

  - name: fact_alarms
    description: "Tabla de hechos de eventos de alarma RAN/OSS. 1 fila por evento de alarma."
    columns:
      - name: alarm_event_id
        description: "Surrogate key del evento de alarma."
        tests:
          - not_null
          - unique

      - name: alarm_id
        description: "FK a dim_alarm_type (tipo de alarma)."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_alarm_type')
                field: alarm_id
      - name: bs_id
        description: "FK al nodo (dim_bs)."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_bs')
                field: bs_id
      - name: cell_id
        description: "FK a dim_cell, cuando la alarma está asociada a una celda concreta."
        tests:
          - relationships:
              arguments:
                to: ref('dim_cell')
                field: cell_id
      - name: occurred_date_id
        description: "Fecha de ocurrencia de la alarma (role-playing de dim_date)."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_id
      - name: cleared_date_id
        description: "Fecha de cierre de la alarma (nullable si sigue activa)."
        tests:
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_id
      - name: is_cleared
        description: "Flag que indica si la alarma está cerrada (true) o activa (false)."

      - name: duration_minutes
        description: "Duración de la alarma en minutos (solo cuando está cerrada)."

  - name: fact_cell_traffic
    columns:
      - name: traffic_event_key
        tests:
          - not_null
          - unique
      - name: cell_key
        tests:
          - not_null
      - name: measure_date_id
        tests:
          - not_null

  - name: dim_date
    columns:
      - name: date_id
        tests:
          - not_null
          - unique
      - name: date_day
        tests:
          - not_null
          - unique

  - name: dim_time_hour
    description: "Dimensión de hora del día (0-23). 1 fila por hora."
    columns:
      - name: time_hour_id
        description: "Clave surrogate de la hora (0–23)."
        tests:
          - not_null
          - unique

  - name: dim_bs
    description: "Dimensión de estaciones base (BS). Una fila por BS, uniendo RAT, subred y versión SW."
    columns:
      - name: bs_id
        description: "Clave surrogate de la BS (derivada de ne_name en Silver)."
        tests:
          - not_null
          - unique
      - name: bs_name
        description: "Nombre de la estación base (ne_name)."
        tests:
          - not_null
      - name: ne_id
        description: "Identificador técnico del elemento de red."
      - name: rat_id
        description: "Clave surrogate de la combinación tipo de nodo + RAT."
      - name: ne_type
        description: "Tipo de nodo (eNodeB, NodeB, BTS, etc.)."
      - name: rat_technology
        description: "Tecnología de acceso radio (2G, 3G, 4G, etc.)."
      - name: home_subnet_id
        description: "Clave surrogate de la subred asociada a la BS."
      - name: home_subnet
        description: "Subred (CIDR / nombre lógico) de la BS."
      - name: software_version_id
        description: "Clave surrogate de la versión de software."
      - name: software_version
        description: "Versión de software instalada en el nodo."
      - name: vendor_id
        description: "Identificador del vendor de la BS."
      - name: om_ip_address
        description: "IP O&M del nodo."
      - name: is_connected
        description: "Flag que indica si el nodo está online."
        tests:
          - not_null
      - name: rnc_by_rat
        description: "RNC asociado (para RAT 3G), si aplica."
      - name: creation_time
        description: "Fecha/hora de creación del nodo en el OSS."
      - name: first_connection_time
        description: "Fecha/hora de primera conexión del nodo."
      - name: dim_created_at
        description: "Timestamp de carga en la dimensión BS."

  - name: dim_cell
    description: "Dimensión de celdas radio (LTE/NR/...). 1 fila por celda lógica."
    columns:
      - name: cell_id
        description: "Surrogate key de la celda."
        tests:
          - not_null
          - unique
      - name: bs_id
        description: "FK al nodo (dim_bs)."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_bs')
                field: bs_id
      - name: cell_name
        description: "Nombre de la celda tal como aparece en el OSS."
        tests:
          - not_null
      - name: cell_status
        description: "Estado operativo de la celda (UP, DOWN, etc.)."
      - name: freqband_id
        description: "Identificador de banda de frecuencia."
      - name: bandwidth_id
        description: "Identificador de ancho de banda."
      - name: dim_created_at
        description: "Timestamp de carga en la dimensión celda."

  - name: dim_alarm_type
    columns:
      - name: alarm_key
        tests:
          - not_null
          - unique
      - name: alarm_id_by_vendor
        tests:
          - not_null
      - name: vendor_id
        tests:
          - not_null

  - name: dim_vendor

  