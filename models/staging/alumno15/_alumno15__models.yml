version: 2

models:

  - name: stg_alumno15__bs
    description: Silver staging model providing a unified and cleaned representation of Base Stations (BS), combining metadata and Ethernet port details.
    config:
      tags: [silver, stg, bs]
    columns:
      - name: bs_id
        description: Surrogate key for the Base Station, generated from bs_name.
        tests:
          - not_null
          - unique
      - name: bs_name
        description: Base Station name as reported in OSS.
        tests:
          - not_null
          - unique
      - name: vendor_id
        description: Surrogate key for the vendor, referencing the vendor dimension.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__bs_vendors')
                field: vendor_id
      - name: vendor_name
        description: Vendor (equipment manufacturer) name. May be null if the vendor is not mapped.
      - name: ne_name
        description: Network element name associated with the Base Station. May be null if the NE is not mapped.
      - name: home_subnet
        description: Home subnet or addressing domain to which the Base Station belongs.
      - name: longitude
        description: Longitude coordinate of the Base Station site (if available).
      - name: latitude
        description: Latitude coordinate of the Base Station site (if available).
      - name: maintenance_region
        description: Maintenance region associated with the Base Station for operational grouping.
      - name: ne_connection_status
        description: Current connection status of the Base Station with the OSS.
      - name: base_station_rat
        description: Radio Access Technology of the Base Station (e.g. LTE).
      - name: base_station_id
        description: Identifier of the Base Station in the OSS.
      - name: total_boards
        description: Total number of boards installed in the Base Station (aggregated from board inventory).
      - name: total_ethernet_ports
        description: Total number of Ethernet ports configured on the Base Station.
      - name: active_ethernet_ports
        description: Number of Ethernet ports currently active (Up).
      - name: total_power_consumption_w
        description: Estimated total power consumption in watts, based on installed boards and reference consumption.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__bs_hardware_summary
    description: Silver staging model summarizing board counts and hardware inventory per Base Station.
    config:
      tags: [silver, stg, bs]
    columns:
      - name: bs_id
        description: Base Station surrogate key.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__bs')
                field: bs_id
      - name: total_boards
        description: Number of boards installed in the Base Station.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__bs_home_subnet
    description: Silver staging model exposing distinct home subnets and their hierarchical breakdown.
    config:
      tags: [silver, stg, bs]
    columns:
      - name: home_subnet_id
        description: Surrogate key for the home subnet.
        tests:
          - not_null
          - unique
      - name: home_subnet
        description: Subnet associated with the Base Station.
        tests:
          - not_null
      - name: root_subnet
        description: Root or parent subnet in the addressing plan.

  - name: stg_alumno15__bs_port
    description: Silver staging model exposing Ethernet ports per Base Station with status and traffic indicators.
    config:
      tags: [silver, stg, bs]
    columns:
      - name: bs_id
        description: Surrogate key of the Base Station.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__bs')
                field: bs_id
      - name: port_no
        description: Ethernet port number.
        tests:
          - not_null
      - name: ne_name
        description: Network element name where the Ethernet port is located.
      - name: cabinet_no
        description: Cabinet identifier for the port location.
      - name: slot_no
        description: Slot identifier within the cabinet.
      - name: port_type
        description: Port type or role (e.g. uplink, downlink, management).
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          arguments:
            column_list:
              - bs_id
              - port_no

  - name: stg_alumno15__cell
    description: Silver staging model exposing LTE cells with their configuration and Base Station relationship.
    config:
      tags: [silver, stg, cell]
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          arguments:
            column_list:
              - bs_id
              - local_cell_id
    columns:
      - name: cell_id
        description: Cell surrogate key.
        tests:
          - not_null
          - unique
      - name: bs_id
        description: Base Station surrogate key to which the cell belongs.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__bs')
                field: bs_id
      - name: bs_name
        description: Name of the Base Station (for convenience).
      - name: ne_name
        description: Network element name from which the cell is served.
      - name: local_cell_id
        description: Local identifier of the cell within the Base Station.
        tests:
          - not_null
      - name: cell_name
        description: Cell name as configured in the OSS.
      - name: cellid
        description: Logical Cell ID (CI).
      - name: phycellid
        description: Physical Cell Identity (PCI).
      - name: rootsequenceidx
        description: Root sequence index used for random access procedures.
      - name: cellactivestate
        description: Activation state of the cell (e.g. active, locked).
      - name: fddtddind
        description: Indicator of FDD or TDD mode.
      - name: crsportnum
        description: Number of CRS ports configured for the cell.
      - name: tx_rx_mode_id
        description: Reference to the Tx/Rx mode catalog.
      - name: tx_rx_mode_desc
        description: Text description of the Tx/Rx mode (e.g. 2T2R, 4T4R).
      - name: freqband
        description: LTE frequency band used by the cell.
      - name: dlearfcn
        description: Downlink EARFCN value.
      - name: ulbandwidth
        description: Uplink bandwidth.
      - name: trackingareaid
        description: Tracking Area identifier associated with the cell.
      - name: tac
        description: Tracking Area Code (TAC).
      - name: nbcellflag
        description: Flag indicating if the cell is Narrowband or standard LTE.

  - name: stg_alumno15__vendor
    description: Silver staging model exposing vendor catalogue with identifiers and contact information.
    config:
      tags: [silver, stg, reference]
    columns:
      - name: vendor_id
        description: Surrogate key for the vendor, generated from vendor_name.
        tests:
          - not_null
          - unique
      - name: vendor_name
        description: Vendor (equipment manufacturer) name.
        tests:
          - not_null
          - unique
      - name: tel_soporte
        description: Main support phone number of the vendor.
      - name: contacto
        description: Primary contact person or role at the vendor.
      - name: tel_contacto
        description: Direct phone number of the primary contact.
      - name: correo_contacto
        description: Email address of the primary contact.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__board_consumption
    description: Silver staging model exposing board-level power consumption reference data by vendor and board type.
    config:
      tags: [silver, stg, reference]
    columns:
      - name: vendor_name
        description: Vendor name, used to join with the vendor dimension.
        tests:
          - not_null
      - name: board_name
        description: Board model name.
        tests:
          - not_null
      - name: consumo_minimo_w
        description: Minimum estimated power consumption of the board (W).
      - name: consumo_medio_w
        description: Average power consumption of the board in watts.
      - name: consumo_tipico_w
        description: Typical power consumption of the board in watts (used as default).
        tests:
          - not_null
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__alarm_log
    description: Silver staging model standardizing raw alarm events from Base Stations.
    config:
      tags: [silver, stg, alarm]
    columns:
      - name: alarm_id
        description: Alarm identifier assigned by OSS.
        tests:
          - not_null
      - name: ne_name
        description: Network element where the alarm occurred (may be null if not mapped from raw).
      - name: occurred_on_nt
        description: Timestamp when the alarm occurred (normalized to project time zone).
      - name: location_information_raw
        description: Raw location information string from the alarm payload.
        tests:
          - not_null
      - name: location_descriptor
        description: Parsed location descriptor (e.g. cell, board, interface) derived from the raw string.
        tests:
          - not_null:
              config:
                severity: warn
      - name: alarm_number
        description: Alarm type identifier as reported by the vendor.
      - name: severity
        description: Severity of the alarm instance (e.g. critical, major, minor).
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__alarm_log_cleared_by
    description: Silver staging model defining the entities that clear alarms and their type.
    config:
      tags: [silver, stg, alarm]
    columns:
      - name: cleared_by_id
        description: Surrogate key for the clearing entity (user or system).
        tests:
          - not_null
          - unique
      - name: cleared_by
        description: User or system responsible for clearing the alarm.
        tests:
          - not_null
      - name: cleared_by_type
        description: Classification of the clearer (not_cleared, system, oss_user).
        tests:
          - not_null
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1

  - name: stg_alumno15__alarms_details
    description: Silver staging model containing static reference information about alarm types, categories and severities.
    config:
      tags: [silver, stg, alarm, reference]
    columns:
      - name: alarm_id
        description: Alarm type identifier (vendor-specific code).
      - name: severity
        description: Default severity assigned to this alarm type.
      - name: vendor_id
        description: Surrogate key for the vendor that defines this alarm catalogue.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          arguments:
            min_value: 1
      - dbt_expectations.expect_compound_columns_to_be_unique:
          arguments:
            column_list:
              - vendor_id
              - alarm_id

  - name: stg_alumno15__statistics_rrc_rab
    description: Silver staging model with RRC/RAB performance statistics for each cell and time interval.
    config:
      tags: [silver, stg, stats]
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          arguments:
            column_list:
              - cell_id
              - measure_time
    columns:
      - name: cell_id
        description: Cell surrogate key referencing the cell staging model.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__cell')
                field: cell_id
      - name: measure_time
        description: Start timestamp of the statistics interval, normalized to project time zone.
        tests:
          - not_null
      - name: l_rrc_connreq_att
        description: Number of RRC connection attempts.
      - name: l_rrc_connreq_succ
        description: Number of successful RRC connections.
      - name: l_rrc_setupfail_rej
        description: Number of RRC setup failures due to rejection.
      - name: l_rrc_setupfail_resfail
        description: Number of RRC setup failures due to resource issues.
      - name: l_erab_attest
        description: Number of E-RAB establishment attempts.
      - name: l_erab_succest
        description: Number of successfully established E-RABs.
      - name: l_erab_failest_mme
        description: Number of E-RAB establishment failures attributed to MME.
      - name: l_erab_abnormrel_other
        description: Number of abnormal E-RAB releases (other reasons).
      - name: l_erab_abnormrel_radio
        description: Number of abnormal E-RAB releases due to radio.
      - name: l_erab_abnormrel_mme
        description: Number of abnormal E-RAB releases attributed to MME.
      - name: l_erab_rel_mme
        description: Number of E-RAB releases initiated by MME.
      - name: l_erab_abnormrel
        description: Total number of abnormal E-RAB releases.
      - name: l_erab_normrel
        description: Total number of normal E-RAB releases.
      - name: l_cell_avail_dur_s
        description: Cell availability duration during the measurement period (seconds).

  - name: stg_alumno15__statistics_traffic
    description: Silver staging model with traffic-related KPIs and throughput statistics for each cell and time interval.
    config:
      tags: [silver, stg, stats]
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          arguments:
            column_list:
              - cell_id
              - measure_time
    columns:
      - name: cell_id
        description: Cell surrogate key referencing the cell staging model.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_alumno15__cell')
                field: cell_id
      - name: measure_time
        description: Start timestamp of the statistics interval, normalized to project time zone.
        tests:
          - not_null
      - name: rb_utilizing_rate_dl_pct
        description: Downlink Resource Block utilization rate (%).
      - name: erab_estab_succ_rate_pct
        description: E-RAB establishment success rate (%).
      - name: call_setup_succ_rate_pct
        description: Call setup success rate (%).
      - name: dl_cell_thp_mbps
        description: Downlink cell throughput in Mbps (averaged over the period).
      - name: ul_cell_thp_mbps
        description: Uplink cell throughput in Mbps (averaged over the period, if available).
